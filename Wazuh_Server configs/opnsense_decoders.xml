<!--
  -  OPNsense decoders
-->

<!-- 
<134>1 2023-05-18T00:00:00+02:30 example.com filterlog 8651 - [meta sequenceId="2"] 7,,,02f4bab031b57d1e30553ce08e0ec131,bge0,match,block,in,4,0x0,,245,54321,0,none,6,tcp,40,104.108.55.235,69.113.96.207,55578,8088,0,S,3895949364,,65535,,

<134>1 2023-05-18T00:02:33+02:30 example.com filterlog 8651 - [meta sequenceId="1379"] 62,,,9071e421d6efbc310961a2fd79ff0a14,bge0,match,pass,out,4,0x0,,64,35828,0,none,1,icmp,84,104.108.55.235,69.113.96.207,datalength=64

<134>1 2026-01-10T21:33:47+07:00 OPNsense.internal filterlog 63281 - [meta sequenceId=\"410\"] 12,,,0,em0,match,rdr,in,4,0x0,,64,47171,0,none,6,tcp,40,10.0.2.5,10.0.2.4,2982,80,0,S,168281438,,512,,

<134>1 2026-01-10T21:33:47+07:00 OPNsense.internal filterlog 63281 - [meta sequenceId=\"409\"] 68,,,1232f88e5fac29a32501e3f051020cac,em2,match,pass,out,4,0x0,,63,26193,0,none,6,tcp,40,192.168.2.1,192.168.2.100,32239,80,0,S,1393948324,,512,,

<134>1 2026-01-10T21:29:38+07:00 OPNsense.internal filterlog 63281 - [meta sequenceId=\"3375\"] 72,,,01ede7d10d9fba9a1888071470568369,em0,match,pass,out,4,0x0,,63,27117,0,DF,6,tcp,60,10.0.2.4,34.120.208.123,59326,443,0,S,562727579,,64240,,mss;sackOK;TS;nop;wscale
-->

<!-- FILTER LOGS -->

<decoder name="opnsense-filterlog">
  <prematch type="pcre2">,\w+,match,.*?,4,</prematch>
  <regex type="pcre2">.*?,([^,]+),match,([^,]+),([^,]+),4,(?:[^,]*,){7}([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),\d+,([^,]*)</regex>
  <order>interface,action,direction,protocol,length,srcip,dstip,srcport,dstport,tcp_flags</order>
</decoder>

<!-- UNBOUND (DNS) -->

<decoder name="opn-unbound">
  <prematch type="pcre2">unbound \d+ - \[meta sequenceId="\d+"\] </prematch>
</decoder>

<decoder name="opn-unbound-fields">
  <parent>opn-unbound</parent>
  <regex offset="after_parent" type="pcre2">\S+ (\w+): (\S+) (\S+) (\S+) (\S+)</regex>
  <order>dns_action,srcip,dns_query,dns_type,dns_class</order>
</decoder>

<decoder name="opn-unbound-fields">
  <parent>opn-unbound</parent>
  <regex offset="after_regex">\s+(\S+)</regex>
  <order>dns_rcode</order>
</decoder>


<!-- DHCLIENT -->

<decoder name="opn-dhclient">
  <prematch type="pcre2">dhclient \d+ - \[meta sequenceId="\d+"\] </prematch>
</decoder>

<decoder name="opn-dhclient-fields">
  <parent>opn-dhclient</parent>
  <regex offset="after_parent" type="pcre2">(.+)</regex>
  <order>message</order>
</decoder>


<!-- FIREWALL -->

<decoder name="opn-firewall">
  <prematch type="pcre2">firewall \d+ - \[meta sequenceId="\d+"\] </prematch>
</decoder>

<decoder name="opn-firewall-fields">
  <parent>opn-firewall</parent>
  <regex offset="after_parent" type="pcre2">(.+)</regex>
  <order>message</order>
</decoder>
